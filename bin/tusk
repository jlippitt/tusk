#!/usr/bin/php
<?php

require_once(__DIR__ . '/../vendor/autoload.php');

function describe($description, \Closure $body)
{
    $container = Tusk\Container::getInstance();
    $suite = $container['Suite']($description, $body);
    $suite->execute();
}

function it($description, \Closure $body)
{
    $container = Tusk\Container::getInstance();
    $spec = $container['Spec']($description, $body);
    $spec->execute();
}

function expect($value)
{
    $container = Tusk\Container::getInstance();
    return $container['ExpectationFactory']->createExpectation($value);
}

function beforeEach(\Closure $body)
{
    $container = Tusk\Container::getInstance();
    $container['Environment']->getContext()->addPreHook($body);
}

function afterEach(\Closure $body)
{
    $container = Tusk\Container::getInstance();
    $container['Environment']->getContext()->addPostHook($body);
}


if ($argc < 2) {
    die("Syntax: tusk <filename>\n");
}

foreach (array_slice($argv, 1) as $filename) {
    require($filename);
}

$scoreboard = Tusk\Container::getInstance()['Scoreboard'];

echo "{$scoreboard->getPassCount()} specs, {$scoreboard->getFailCount()} failures\n";
